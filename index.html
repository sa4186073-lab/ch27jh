<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طباخ الدار | مساعدك الذكي في المطبخ</title>
    
    <!-- Fonts: Tajawal for a clean, modern Arabic look -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        chef: {
                            50: '#FFF7ED',
                            100: '#FFEDD5',
                            200: '#FED7AA',
                            300: '#FDBA74',
                            400: '#FB923C',
                            500: '#F97316', // Primary Orange
                            600: '#EA580C',
                            700: '#C2410C',
                            800: '#9A3412',
                            900: '#7C2D12',
                        },
                        spice: '#DC2626', // Red for accents
                    },
                    boxShadow: {
                        'card': '0 10px 30px -5px rgba(249, 115, 22, 0.2)',
                        'inner-light': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.3)',
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'simmer': 'simmer 2s infinite linear',
                        'pop-in': 'pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        simmer: {
                            '0%': { transform: 'translateY(0) scale(1)', opacity: 0.5 },
                            '50%': { transform: 'translateY(-5px) scale(1.1)', opacity: 1 },
                            '100%': { transform: 'translateY(-10px) scale(1)', opacity: 0 },
                        },
                        'pop-in': {
                            '0%': { opacity: 0, transform: 'scale(0.9) translateY(10px)' },
                            '100%': { opacity: 1, transform: 'scale(1) translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.263.1"
            }
        }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #FFF7ED;
            background-image: radial-gradient(#FDBA74 1px, transparent 1px);
            background-size: 20px 20px;
            overflow-x: hidden;
        }
        
        .recipe-card {
            background: white;
            border-radius: 2rem;
            position: relative;
            overflow: hidden;
        }

        .recipe-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #F97316, #DC2626);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #FFF7ED; }
        ::-webkit-scrollbar-thumb { background: #F97316; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            ChefHat, Utensils, Flame, Timer, Plus, X, 
            ShoppingBag, Settings, Key, Search, ArrowRight,
            Carrot, Beef, Pizza, Soup, Coffee, AlertCircle, Sparkles
        } from 'lucide-react';

        // --- Mock Data (Demo Mode) ---
        const MOCK_RECIPES = [
            {
                title: "كبسة الدجاج السريعة",
                time: "45 دقيقة",
                difficulty: "متوسطة",
                ingredients: ["دجاج", "أرز", "طماطم", "بصل", "بهارات"],
                steps: [
                    "حمّر البصل حتى يصبح ذهبياً ثم أضف الدجاج وقلبه.",
                    "أضف الطماطم والبهارات واتركها تتسبك قليلاً.",
                    "أضف الماء المغلي واترك الدجاج حتى ينضج.",
                    "أضف الأرز المغسول واتركه على نار هادئة حتى يتشرب الماء.",
                    "قدمه ساخناً مع السلطة الحارة وبالعافية!"
                ]
            },
            {
                title: "شكشوكة عدنية",
                time: "15 دقيقة",
                difficulty: "سهلة",
                ingredients: ["بيض", "طماطم", "بصل", "فلفل حار"],
                steps: [
                    "قطع البصل والطماطم والفلفل قطعاً صغيرة.",
                    "قلي البصل في الزيت حتى يذبل.",
                    "أضف الطماطم والفلفل والملح واتركها حتى تذوب الطماطم.",
                    "أضف البيض وحركه بسرعة حتى ينضج.",
                    "رش قليلاً من الكمون وقدمها مع الخبز والشاي العدني."
                ]
            }
        ];

        // --- Components ---

        function App() {
            // Inputs
            const [ingredientInput, setIngredientInput] = useState('');
            const [ingredients, setIngredients] = useState([]);
            const [cuisine, setCuisine] = useState('any'); // any | yemeni | italian | healthy
            
            // System
            const [recipe, setRecipe] = useState(null);
            const [isCooking, setIsCooking] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
            
            const ingredientInputRef = useRef(null);

            const CUISINES = [
                { id: 'any', name: 'أي شيء', icon: Sparkles },
                { id: 'yemeni', name: 'يمني أصيل', icon: Flame },
                { id: 'italian', name: 'إيطالي', icon: Pizza },
                { id: 'healthy', name: 'صحي', icon: Carrot },
            ];

            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('gemini_api_key', key);
            };

            const addIngredient = (e) => {
                if ((e.key === 'Enter' || e.type === 'click') && ingredientInput.trim()) {
                    if (!ingredients.includes(ingredientInput.trim())) {
                        setIngredients([...ingredients, ingredientInput.trim()]);
                    }
                    setIngredientInput('');
                }
            };

            const removeIngredient = (ing) => {
                setIngredients(ingredients.filter(i => i !== ing));
            };

            const generateRecipe = async () => {
                if (ingredients.length === 0) return;
                setIsCooking(true);
                setRecipe(null);

                // Demo Mode
                if (!apiKey) {
                    setTimeout(() => {
                        const randomRecipe = MOCK_RECIPES[Math.floor(Math.random() * MOCK_RECIPES.length)];
                        setRecipe(randomRecipe);
                        setIsCooking(false);
                    }, 2500);
                    return;
                }

                // AI Prompt
                let styleNote = "";
                if (cuisine === 'yemeni') styleNote = "النمط: أكلة يمنية شعبية لذيذة.";
                if (cuisine === 'healthy') styleNote = "النمط: وجبة صحية قليلة السعرات.";
                if (cuisine === 'italian') styleNote = "النمط: طبق إيطالي (باستا/بيتزا...).";

                const prompt = `أنا طباخ منزلي ولدي هذه المكونات فقط: [${ingredients.join(', ')}].
                اقترح عليّ وصفة طبخ واحدة مبتكرة ولذيذة.
                ${styleNote}
                
                المخرجات المطلوبة بصيغة JSON فقط:
                {
                    "title": "اسم الطبخة",
                    "time": "وقت التحضير",
                    "difficulty": "مستوى الصعوبة",
                    "ingredients": ["قائمة المكونات (يمكنك إضافة بهارات أساسية يفترض وجودها في أي بيت)"],
                    "steps": ["خطوة 1", "خطوة 2", ...]
                }`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await response.json();
                    const result = JSON.parse(data.candidates[0].content.parts[0].text);
                    setRecipe(result);
                } catch (error) {
                    console.error(error);
                    // Fallback to text if JSON fails or API error
                    setRecipe(MOCK_RECIPES[0]); 
                } finally {
                    setIsCooking(false);
                }
            };

            return (
                <div className="min-h-screen relative font-sans text-gray-800">
                    
                    {/* Header */}
                    <nav className="bg-white/80 backdrop-blur-md sticky top-0 z-40 border-b border-orange-100 shadow-sm">
                        <div className="container mx-auto px-4 h-16 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="bg-chef-500 p-2 rounded-xl text-white shadow-lg">
                                    <ChefHat className="w-6 h-6" />
                                </div>
                                <h1 className="text-2xl font-black text-chef-800 tracking-tight">طباخ الدار</h1>
                            </div>
                            <button onClick={() => setShowSettings(!showSettings)} className="p-2 hover:bg-orange-50 rounded-full text-chef-600 transition-colors">
                                <Settings className="w-6 h-6" />
                            </button>
                        </div>
                    </nav>

                    {/* API Key Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm animate-pop-in">
                            <div className="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl relative">
                                <button onClick={() => setShowSettings(false)} className="absolute top-4 left-4 text-gray-400 hover:text-gray-600"><X /></button>
                                <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-chef-700">
                                    <Key className="w-5 h-5" /> إعدادات الشيف الذكي
                                </h3>
                                <input 
                                    type="password" 
                                    value={apiKey}
                                    onChange={(e) => saveApiKey(e.target.value)}
                                    className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-chef-500 mb-2"
                                    placeholder="أدخل مفتاح API هنا..."
                                />
                                <div className="text-xs text-gray-500">
                                    * بدون المفتاح، سأعرض لك وصفات تجريبية محفوظة مسبقاً.
                                </div>
                                <button onClick={() => setShowSettings(false)} className="mt-4 w-full bg-chef-500 text-white py-3 rounded-xl font-bold hover:bg-chef-600 transition-colors">حفظ وإغلاق</button>
                            </div>
                        </div>
                    )}

                    <main className="container mx-auto px-4 py-8 max-w-5xl">
                        
                        <div className="grid lg:grid-cols-12 gap-8">
                            
                            {/* Input Section */}
                            <div className="lg:col-span-5 space-y-6">
                                
                                {/* Welcome Card */}
                                <div className="bg-white p-6 rounded-[2rem] shadow-card border border-orange-50">
                                    <h2 className="text-2xl font-bold mb-2 text-chef-900">إيش موجود في الثلاجة؟</h2>
                                    <p className="text-gray-500 text-sm mb-6">أضف المكونات المتوفرة لديك وسأبتكر لك طبخة.</p>
                                    
                                    {/* Ingredient Input */}
                                    <div className="relative mb-4 group">
                                        <input 
                                            ref={ingredientInputRef}
                                            type="text" 
                                            value={ingredientInput}
                                            onChange={(e) => setIngredientInput(e.target.value)}
                                            onKeyDown={addIngredient}
                                            placeholder="أضف مكوناً (مثلاً: دجاج، بطاطس)..."
                                            className="w-full h-14 bg-chef-50 border-2 border-transparent group-hover:border-chef-200 focus:border-chef-500 rounded-2xl px-12 text-lg outline-none transition-all placeholder-gray-400"
                                        />
                                        <ShoppingBag className="absolute right-4 top-4 text-chef-400 w-6 h-6" />
                                        <button 
                                            onClick={addIngredient}
                                            className="absolute left-2 top-2 bottom-2 bg-chef-500 text-white px-4 rounded-xl hover:bg-chef-600 transition-all font-bold disabled:opacity-50 disabled:cursor-not-allowed"
                                            disabled={!ingredientInput.trim()}
                                        >
                                            <Plus className="w-5 h-5" />
                                        </button>
                                    </div>

                                    {/* Tags Display */}
                                    <div className="flex flex-wrap gap-2 min-h-[60px] content-start bg-gray-50 p-4 rounded-2xl border border-gray-100 mb-6">
                                        {ingredients.length === 0 && (
                                            <span className="text-gray-400 text-sm w-full text-center py-2">لا توجد مكونات بعد...</span>
                                        )}
                                        {ingredients.map((ing, idx) => (
                                            <span key={idx} className="animate-pop-in bg-white border border-chef-200 text-chef-800 px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-2 shadow-sm">
                                                {ing}
                                                <button onClick={() => removeIngredient(ing)} className="text-red-400 hover:text-red-600 bg-red-50 hover:bg-red-100 rounded-full p-0.5"><X className="w-3 h-3" /></button>
                                            </span>
                                        ))}
                                    </div>

                                    {/* Cuisine Filter */}
                                    <div className="mb-6">
                                        <label className="text-xs font-bold text-gray-500 mb-3 block">مزاجك اليوم؟</label>
                                        <div className="grid grid-cols-2 gap-2">
                                            {CUISINES.map((c) => (
                                                <button 
                                                    key={c.id}
                                                    onClick={() => setCuisine(c.id)}
                                                    className={`p-3 rounded-xl flex items-center justify-center gap-2 transition-all border text-sm font-bold
                                                        ${cuisine === c.id 
                                                            ? 'bg-chef-500 text-white border-chef-500 shadow-lg scale-105' 
                                                            : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}
                                                    `}
                                                >
                                                    <c.icon className="w-4 h-4" /> {c.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Cook Button */}
                                    <button 
                                        onClick={generateRecipe}
                                        disabled={isCooking || ingredients.length === 0}
                                        className={`
                                            w-full py-4 rounded-2xl font-black text-xl shadow-xl transition-all relative overflow-hidden group flex items-center justify-center gap-3
                                            ${isCooking || ingredients.length === 0 ? 'bg-gray-300 cursor-not-allowed text-gray-500' : 'bg-gradient-to-r from-chef-600 to-spice text-white hover:scale-[1.02]'}
                                        `}
                                    >
                                        {isCooking ? (
                                            <>
                                                <div className="flex items-center gap-1">
                                                    <div className="w-2 h-2 bg-white rounded-full animate-bounce"></div>
                                                    <div className="w-2 h-2 bg-white rounded-full animate-bounce delay-100"></div>
                                                    <div className="w-2 h-2 bg-white rounded-full animate-bounce delay-200"></div>
                                                </div>
                                                <span>جاري الطبخ...</span>
                                            </>
                                        ) : (
                                            <>
                                                <Utensils className="w-6 h-6" />
                                                <span>اطبخ الآن!</span>
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>

                            {/* Result Section */}
                            <div className="lg:col-span-7 flex flex-col items-center justify-center min-h-[500px]">
                                {!recipe && !isCooking && (
                                    <div className="text-center opacity-40 space-y-4">
                                        <div className="bg-chef-200 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <ChefHat className="w-16 h-16 text-chef-600" />
                                        </div>
                                        <h3 className="text-2xl font-bold text-chef-900">المطبخ جاهز</h3>
                                        <p className="text-gray-600">أدخل المكونات واضغط على "اطبخ الآن"</p>
                                    </div>
                                )}

                                {isCooking && (
                                    <div className="text-center space-y-6">
                                        <div className="relative w-32 h-32 mx-auto">
                                            {/* Pot Animation */}
                                            <div className="absolute inset-x-0 bottom-0 h-20 bg-gray-800 rounded-b-3xl"></div>
                                            <div className="absolute inset-x-2 bottom-20 h-4 bg-gray-700"></div>
                                            {/* Steam */}
                                            <div className="absolute left-8 bottom-24 text-gray-400 animate-simmer"><Flame className="w-6 h-6" /></div>
                                            <div className="absolute left-14 bottom-28 text-gray-400 animate-simmer delay-100"><Flame className="w-6 h-6" /></div>
                                            <div className="absolute left-20 bottom-24 text-gray-400 animate-simmer delay-200"><Flame className="w-6 h-6" /></div>
                                        </div>
                                        <p className="text-xl font-bold text-chef-700 animate-pulse">الشيف يفكر في وصفة عبقرية...</p>
                                    </div>
                                )}

                                {recipe && !isCooking && (
                                    <div className="w-full recipe-card shadow-card animate-pop-in p-8 border border-gray-100">
                                        
                                        {/* Header Info */}
                                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-gray-100 pb-6 mb-6 gap-4">
                                            <div>
                                                <span className="bg-chef-100 text-chef-700 px-3 py-1 rounded-full text-xs font-bold mb-2 inline-block">وصفة مختارة لك</span>
                                                <h2 className="text-3xl font-black text-chef-900">{recipe.title}</h2>
                                            </div>
                                            <div className="flex gap-4 text-sm font-bold text-gray-600">
                                                <div className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-xl">
                                                    <Timer className="w-5 h-5 text-chef-500" /> {recipe.time}
                                                </div>
                                                <div className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-xl">
                                                    <Flame className="w-5 h-5 text-spice" /> {recipe.difficulty}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid md:grid-cols-2 gap-8">
                                            {/* Ingredients List */}
                                            <div className="bg-chef-50 rounded-2xl p-6">
                                                <h3 className="text-lg font-bold text-chef-800 mb-4 flex items-center gap-2">
                                                    <ShoppingBag className="w-5 h-5" /> المقادير
                                                </h3>
                                                <ul className="space-y-3">
                                                    {recipe.ingredients.map((item, i) => (
                                                        <li key={i} className="flex items-center gap-3 text-gray-700">
                                                            <div className="w-2 h-2 rounded-full bg-chef-400"></div>
                                                            {item}
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>

                                            {/* Steps List */}
                                            <div>
                                                <h3 className="text-lg font-bold text-chef-800 mb-4 flex items-center gap-2">
                                                    <ChefHat className="w-5 h-5" /> طريقة التحضير
                                                </h3>
                                                <div className="space-y-6">
                                                    {recipe.steps.map((step, i) => (
                                                        <div key={i} className="flex gap-4">
                                                            <div className="flex-shrink-0 w-8 h-8 rounded-full bg-chef-100 text-chef-600 font-bold flex items-center justify-center border-2 border-chef-200">
                                                                {i + 1}
                                                            </div>
                                                            <p className="text-gray-600 leading-relaxed pt-1">{step}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="mt-8 pt-6 border-t border-gray-100 text-center">
                                            <button 
                                                onClick={() => {
                                                    const text = `وصفة: ${recipe.title}\n\nالمكونات:\n${recipe.ingredients.join('\n')}\n\nالطريقة:\n${recipe.steps.join('\n')}`;
                                                    navigator.clipboard.writeText(text);
                                                }}
                                                className="text-chef-600 font-bold hover:text-chef-800 flex items-center justify-center gap-2 mx-auto text-sm"
                                            >
                                                <ShoppingBag className="w-4 h-4" /> نسخ الوصفة
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>